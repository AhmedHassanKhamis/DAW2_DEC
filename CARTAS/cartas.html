<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cartas</title>
    <link rel="stylesheet" href="style.css">
</head>
<script>
    let cartas = [];
    tiempo = 30000;
    let tiempo_contador = (tiempo / 1000);

    async function peticion(url, array) {
        const datos = await fetch(url);
        const json = await datos.json();
        let variable = json;
        Impimir(variable, array);
    }

    peticion("https://deckofcardsapi.com/api/deck/new/draw/?count=10", cartas);

    function Impimir(variable, array) {
        array = variable.cards;
        array.forEach(element => {
            cartas.push(element);
        });
    }

    function crearBoton() {
        let cabecera = document.querySelector("header")
        if (!cabecera) {
            cabecera = document.createElement("header");
        }
        cabecera.innerHTML = `
        <h2>CARTAS</h2>
        <h5>Ahmed Hassan Khamis</h5>
        <h6>00:${tiempo_contador}</h6>
        `;
        let boton = document.createElement("button");
        let boton_texto = document.createTextNode("EMPEZAR JUEGO");
        boton.appendChild(boton_texto);
        boton.addEventListener('click', construirBaraja);
        cabecera.appendChild(boton);
        document.body.appendChild(cabecera);
    }


    function construirCartas(array) {
        let seleccion = document.getElementsByTagName("main");
        array.forEach(carta => {
            let imagen = document.createElement("img");
            let dorso = document.createElement("img");
            let contenedor = document.createElement("div");
            let clase = document.createAttribute("class");
            clase.value = "carta";
            contenedor.setAttributeNode(clase);
            let src = document.createAttribute("src");
            let src2 = document.createAttribute("src");
            src.value = carta.image;
            src2.value = "https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcROdQOON3P__LRi1PpyFl8NWYme_4fo3pAaog&usqp=CAU"
            imagen.setAttributeNode(src);
            dorso.setAttributeNode(src2);
            contenedor.appendChild(dorso);
            contenedor.appendChild(imagen);
            contenedor.addEventListener('click', ((e) => {
                e.currentTarget.classList.toggle("girado");
            }))
            seleccion[0].appendChild(contenedor);
        })
    }

    function construirBaraja() {
        let marcador = document.querySelector("ul");
        if (marcador) {
            ul.parentElement.removeChild(ul);
        }
        let boton = document.querySelector("button");
        boton.parentElement.removeChild(boton);
        document.body.insertAdjacentHTML("beforeend", "<main></main>");
        construirCartas(cartas);
        empezarContador();
    }

    function crearMarcador() {
        let ul = document.createElement("ul");
        for (let index = 0; index < localStorage.length; index++) {
            let li = document.createElement("li");
            li.innerText = localStorage.getItem(index);
            ul.appendChild(li);
        }
        let header = document.querySelector("header");
        header.appendChild(ul);
    }

    function crearFormulario() {
        document.body.insertAdjacentHTML("afterend"
            , `
        <form id="NOMBRE">
            <label for="nombre">Introduce tu nombre</label>
            <input type="text" name="nombre" required />
            <input type="submit" name="submit" value="GUARDAR ðŸ’¾"/>
        </form>
        `);
    }

    function empezarContador() {
        let cartas_eliminar = document.querySelector("main");
        setTimeout(function () {
            clearInterval(intervalo);
            cartas_eliminar.remove();
            crearMarcador();
            crearFormulario();
            async function rellenar_formulario() {
                let promesa = new Promise(function (terminado, noterminado) {
                    let enviado = document.querySelector("input[type='submit']");
                    enviado.addEventListener("click", function () {
                        let nombre = document.querySelector("input[type='text']").value;
                        if (nombre) {
                            usuario_numero = localStorage.length;
                            localStorage.setItem(usuario_numero, nombre)
                            terminado('listo');
                        } else {
                            throw new Error('No pusiste nombre');
                            alert('no pusiste tu nombre');
                        }
                    })
                })
                await promesa;
                crearBoton();
            }
            rellenar_formulario();
        }, tiempo);
        let h6 = document.querySelector("h6");
        let intervalo =  setInterval(function () {
            h6.innerText = `00:${tiempo_contador}`;
            tiempo_contador--;
        }, 1000);

    }


    window.onload = function () {
        crearBoton();
    }



</script>

<body>

</body>

</html>